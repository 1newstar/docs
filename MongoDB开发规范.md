#### MongoDB开发规范
##### 库的设计
- 库名全部采用小写，禁止使用除 _ 下划线外的特殊字符
- 库名禁止使用数字打头
- 库名禁止包含特殊字符
- 不使用系统保留库名(admin ,local , config)等

##### 集合的设计
- 集合名全部采用小写，禁止使用除 _ 下划线外的特殊字符
- 集合名称禁止使用数字开头
- 集合名称禁止使用system开头(system为MongoDB系统集合的前缀)
- 集合名称最多为64个字符
- 集合的字段设计不要过长
- 为了避免库级锁带来的问题，应尽量对写入较大的集合使用“单库单集合”的结构，所以对于新增业务应尽量创建新库，而不是在现有库中创建新集合
- 部分日志场景下，可以使用固定集合自动淘汰老数据

##### 索引的设计
- 为你的每一个查询建立合适的索引
- 创建合适的组合索引，不要依赖于交叉索引
- 组合索引字段顺序：匹配条件在前，范围条件在后
- 尽可能使用覆盖索引
- 索引不能被用到正则表达式、非操作符的查询用到
- 每个集合最多有64个索引
- 控制联合索引中字段的个数（最多支持31个字段）
- 索引名称长度，包括数据库集合名称在内最大不超过125字符
- 需要自动过期的数据，可以加TTL索引
- 创建索引必须提工单由DBA以background方式在后台创建
- 不确定是否走索引的SQL，可以使用explain查看其执行计划

#### 连接配置
- 避免使用短连接(短连接增加额外的conn、auth、close的开销)
- 正确使用写关注设置 Write Concern
```
MongoDB建议对重要的数据使用 {w:"marjority"} 的选项。{w:"majority"} 可以保证数据在复制到多数节点后才返回成功结果。
使用该机制可以有效防止数据回滚的发生。
```
- 正确使用读选项设置 Read Preference
- 对写操作使用retry机制
